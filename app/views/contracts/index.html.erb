
<h1><%= link_to "contracts", contracts_path %></h1>

<table id="contract" class="display">
 <thead> 
 <tr>
	<th>No.</th>
	<th>deposit_rcvd</th>
	<th>expect ship date </th>
	<th>prefoma sales contract date</th>
	<th>summary</th>
	<th>customer</th>
	<th>PM</th>
	<th>products</th>
	<th>projects</th>
	<th>revision</th>
  </tr>
  </thead>
    <% @poptions = Set.new  %>
    <% Product.all.each do |f|  %>
         <% @poptions.add(f.name) %>
    <% end  %>
 <tbody>
<% @contracts.each do |contract| %>
  <tr>
  <!--%= form_for(contract) do |f| %-->
    <td><%=  best_in_place contract, :No %></td>
    <td><%= best_in_place contract, :deposit_rcvd, :type => :date %></td>
    <td><%= best_in_place contract,:expected_ship_date, :type => :date %></td>
    <td><%= best_in_place contract,:prefoma_sales_contract, :type => :date %></td>
    <td><%= best_in_place contract,:summary, :type => :textarea %></td>
    <td><% if ! contract.customer_id.nil?  %>
 <%= link_to Customer.find(contract.customer_id).name, customers_path(:id => contract.customer_id) %>
      <% else %>
    <%= best_in_place contract,:customer_id %>
      <% end %>
    </td>
    <td><% if ! contract.user_id.nil?  %>
 <%= link_to User.find(contract.user_id).username, edit_user_registration_path(contract.user_id) %>
        <% else %>
    <%= best_in_place contract,:user_id %>
        <% end  %>
     </td>
    <td>
    <% if  contract.products.exists %>
    <%= link_to "contracted products", products_path(:contract => contract.id)%>
    <%end%>
    <% if ! @poptions.nil? %>
     <%= form_tag '/contracts/add_product', :method => 'get' do%>
     <%= select_tag "add_product", options_for_select(@poptions) %>
     <%= text_field 'contract','id', :value => contract.id, :size => 2  %>
     <%= submit_tag t(:add_product) %>
     <% end %>
    <!--% end  %-->
    </td>
    <td></td>
    <td><%= contract.versions.length %>
        <% if user_signed_in?   %>
        <% if (current_user.username == "admin")  %>
          <%= contract.versions %>
        <% end  %>
        <% end %>
    </td>
  <% end %>
  </tr>
<% end %>
 </tbody>
</table>
<%= will_paginate @contracts %>
<br />
<%= link_to "add contract",new_contract_path %>
